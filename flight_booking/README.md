# âœˆï¸ æ™ºèƒ½æœºç¥¨é¢„è®¢ç³»ç»Ÿ - Agent Skills Demo

åŸºäº **Python FastAPI** + **å¤§æ¨¡å‹** + **Agent Skills** æ¶æ„çš„æ™ºèƒ½æœºç¥¨é¢„è®¢ç³»ç»Ÿæ¼”ç¤ºã€‚

## ğŸ¯ åŠŸèƒ½æ¼”ç¤º

ç”¨æˆ·è¾“å…¥è‡ªç„¶è¯­è¨€éœ€æ±‚ï¼Œç³»ç»Ÿè‡ªåŠ¨å®Œæˆï¼š

```
"å¸®æˆ‘è®¢ä¸€å¼ æ˜å¤©10ç‚¹ä»æµ·å£åˆ°åŒ—äº¬çš„æœºç¥¨"
```

ç³»ç»Ÿå°†ä¾æ¬¡æ‰§è¡Œ 5 ä¸ª Agent Skillsï¼š

| Step | Skill | åŠŸèƒ½ |
|------|-------|------|
| 1 | ğŸ§  éœ€æ±‚åˆ†æ | è§£æç”¨æˆ·æ„å›¾ï¼Œæå–å‡ºå‘åœ°ã€ç›®çš„åœ°ã€æ—¶é—´ç­‰ |
| 2 | ğŸ” èˆªç­æŸ¥è¯¢ | è°ƒç”¨èˆªç­APIæŸ¥è¯¢å¯ç”¨èˆªç­ï¼Œæ™ºèƒ½æ¨è |
| 3 | ğŸ‘¤ ä¹˜å®¢ä¿¡æ¯ | æ”¶é›†ä¹˜å®¢ä¿¡æ¯ï¼Œç¡®è®¤è´¹ç”¨æ˜ç»† |
| 4 | ğŸ’³ æ”¯ä»˜å¤„ç† | æ¨¡æ‹Ÿæ”¯ä»˜æµç¨‹ï¼Œå®Œæˆè®¢å•æ”¯ä»˜ |
| 5 | ğŸ« è®¢ç¥¨ç»“æœ | ç”Ÿæˆç”µå­å®¢ç¥¨ï¼Œå±•ç¤ºå®Œæ•´è¡Œç¨‹å• |

## ğŸ“ é¡¹ç›®ç»“æ„

```
flight_booking/
â”œâ”€â”€ __init__.py              # åŒ…åˆå§‹åŒ–
â”œâ”€â”€ config.py                # é…ç½®ç®¡ç†
â”œâ”€â”€ llm_client.py            # å¤§æ¨¡å‹å®¢æˆ·ç«¯ (æµå¼è¾“å‡º)
â”œâ”€â”€ main.py                  # FastAPI ä¸»å…¥å£
â”œâ”€â”€ index.html               # å‰ç«¯é¡µé¢
â”œâ”€â”€ README.md                # è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ skills/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base.py              # Skill æŠ½è±¡åŸºç±»
â”‚   â””â”€â”€ definitions.py       # 5ä¸ª Skill å®ç°
â”œâ”€â”€ workflow/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ engine.py            # å·¥ä½œæµå¼•æ“
â””â”€â”€ tools/
    â”œâ”€â”€ __init__.py
    â””â”€â”€ flight_api.py        # æ¨¡æ‹Ÿèˆªç­APIå·¥å…·
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pip install fastapi uvicorn httpx pydantic python-dotenv
```

### 2. é…ç½®ç¯å¢ƒå˜é‡ (å¯é€‰)

```bash
# åˆ›å»º .env æ–‡ä»¶
cat > .env << EOF
LLM_PROVIDER=openai
LLM_BASE_URL=https://api.openai.com/v1
LLM_API_KEY=sk-your-api-key
LLM_MODEL=gpt-4o-mini
PORT=8001
EOF
```

### 3. å¯åŠ¨åç«¯æœåŠ¡

```bash
# æ–¹å¼1: ç›´æ¥è¿è¡Œ
python -m flight_booking.main

# æ–¹å¼2: uvicorn
uvicorn flight_booking.main:app --reload --port 8001
```

### 4. æ‰“å¼€å‰ç«¯é¡µé¢

- ç›´æ¥ç”¨æµè§ˆå™¨æ‰“å¼€ `flight_booking/index.html`
- æˆ–ä½¿ç”¨ Live Server / http-server

### 5. é…ç½® API Key

1. ç‚¹å‡»å³ä¸Šè§’ **âš™ï¸ APIé…ç½®**
2. é€‰æ‹©æ¨¡å‹æä¾›å•†ï¼ˆOpenAI/æ™ºè°±/DeepSeekç­‰ï¼‰
3. å¡«å…¥ API Key
4. ä¿å­˜é…ç½®

### 6. å¼€å§‹ä½¿ç”¨

è¾“å…¥è®¢ç¥¨éœ€æ±‚ï¼Œç‚¹å‡» **âœˆï¸ å¼€å§‹é¢„è®¢**ï¼Œè§‚çœ‹ Agent è‡ªåŠ¨å®Œæˆå…¨éƒ¨æµç¨‹ï¼

## ğŸ“¡ API æ¥å£

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| `GET` | `/api/health` | å¥åº·æ£€æŸ¥ |
| `GET` | `/api/skills` | è·å–æ‰€æœ‰ Skills |
| `POST` | `/api/booking/run` | è¿è¡Œé¢„è®¢å·¥ä½œæµ (SSE) |
| `POST` | `/api/config/validate` | éªŒè¯ API é…ç½® |
| `GET` | `/api/flights/search` | ç›´æ¥æŸ¥è¯¢èˆªç­ (æµ‹è¯•) |

### ç¤ºä¾‹è¯·æ±‚

```bash
# è¿è¡Œé¢„è®¢å·¥ä½œæµ
curl -X POST http://localhost:8001/api/booking/run \
  -H "Content-Type: application/json" \
  -d '{
    "user_request": "å¸®æˆ‘è®¢ä¸€å¼ æ˜å¤©10ç‚¹ä»æµ·å£åˆ°åŒ—äº¬çš„æœºç¥¨",
    "config": {
      "provider": "openai",
      "base_url": "https://api.openai.com/v1",
      "api_key": "sk-xxx",
      "model": "gpt-4o-mini"
    }
  }'
```

## ğŸ—ï¸ æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Frontend (index.html)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ ConfigMgr   â”‚  â”‚ ApiClient    â”‚  â”‚ UIController    â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    SSE Stream                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 Python FastAPI                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              WorkflowEngine (äº‹ä»¶é©±åŠ¨)               â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚  IntentAnalysis â†’ FlightSearch â†’ PassengerInfo      â”‚    â”‚
â”‚  â”‚       â†’ Payment â†’ BookingResult                      â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚                   Context (ä¸Šä¸‹æ–‡)                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     Tools Layer                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  FlightAPITools (æ¨¡æ‹Ÿèˆªç­æŸ¥è¯¢ã€ä¹˜å®¢ç®¡ç†ã€æ”¯ä»˜)        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      LLMClient                               â”‚
â”‚               stream_chat_completion()                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           External LLM API (OpenAI/æ™ºè°±/DeepSeek)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ æ ¸å¿ƒæ¨¡å—è¯´æ˜

### 1. FlightAPITools (æ¨¡æ‹Ÿå·¥å…·)

```python
# èˆªç­æŸ¥è¯¢
flights = flight_tools.search_flights(
    departure_city="æµ·å£",
    arrival_city="åŒ—äº¬",
    date="2024-01-15",
    preferred_time="10:00"
)

# è®¾ç½®ä¹˜å®¢ä¿¡æ¯
flight_tools.set_passenger_info([{
    "name": "å¼ ä¸‰",
    "id_type": "èº«ä»½è¯",
    "id_number": "110101199001011234",
    "phone": "13800138001"
}])

# å¤„ç†æ”¯ä»˜
result = flight_tools.process_payment(
    flight_info=selected_flight,
    payment_method="æ”¯ä»˜å®"
)
```

### 2. Skill å®šä¹‰

æ¯ä¸ª Skill åŒ…å«ï¼š
- `get_system_prompt()`: å®šä¹‰ AI çš„è§’è‰²å’Œè¾“å‡ºæ ¼å¼
- `get_user_prompt()`: æ„å»ºç”¨æˆ·æç¤ºè¯ï¼Œæ³¨å…¥ä¸Šä¸‹æ–‡

### 3. å·¥ä½œæµå¼•æ“

- æŒ‰é¡ºåºæ‰§è¡Œ Skills
- è‡ªåŠ¨ä¼ é€’ä¸Šä¸‹æ–‡ (å‰ä¸€ä¸ª Skill çš„è¾“å‡ºä½œä¸ºåä¸€ä¸ªçš„è¾“å…¥)
- å‘å°„äº‹ä»¶ä¾›å‰ç«¯å®æ—¶æ¸²æŸ“
- æ”¯æŒä» LLM è¾“å‡ºä¸­æå–ç»“æ„åŒ– JSON æ•°æ®

## ğŸŒŸ ç‰¹è‰²åŠŸèƒ½

1. **è‡ªç„¶è¯­è¨€ç†è§£**: æ”¯æŒå¤šç§è¡¨è¾¾æ–¹å¼æè¿°è®¢ç¥¨éœ€æ±‚
2. **æ™ºèƒ½æ¨è**: æ ¹æ®ç”¨æˆ·åå¥½æ—¶é—´æ¨èæœ€åˆé€‚çš„èˆªç­
3. **æµå¼è¾“å‡º**: SSE å®æ—¶å±•ç¤º AI å¤„ç†è¿‡ç¨‹
4. **æ¨¡æ‹Ÿå®Œæ•´æµç¨‹**: ä»æŸ¥è¯¢åˆ°å‡ºç¥¨çš„å®Œæ•´ä½“éªŒ
5. **å¤šæ¨¡å‹æ”¯æŒ**: OpenAI/æ™ºè°±/DeepSeek/Moonshot

## ğŸ“ æ‰©å±•å¼€å‘

### æ·»åŠ æ–°çš„ Skill

```python
from flight_booking.skills.base import BaseSkill, SkillInput

class MyCustomSkill(BaseSkill):
    def __init__(self):
        super().__init__()
        self.id = "my_skill"
        self.name = "è‡ªå®šä¹‰æŠ€èƒ½"
        self.icon = "â­"
    
    def get_system_prompt(self) -> str:
        return "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šåŠ©æ‰‹..."
    
    def get_user_prompt(self, input_data: SkillInput) -> str:
        return f"å¤„ç†: {input_data.user_request}"

# æ³¨å†Œåˆ°å·¥ä½œæµ
from flight_booking.skills.definitions import skill_registry
skill_registry.register(MyCustomSkill())
```

### æ¥å…¥çœŸå®èˆªç­ API

æ›¿æ¢ `tools/flight_api.py` ä¸­çš„æ¨¡æ‹Ÿå®ç°ï¼Œæ¥å…¥ï¼š
- æºç¨‹ API
- é£çŒª API
- èˆªç©ºå…¬å¸å®˜æ–¹ API

## ğŸ“„ License

MIT License